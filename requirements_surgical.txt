# SURGICAL INTEGRATION REQUIREMENTS - MuseTalk + LatentSync UNet3D
# Created through surgical dependency analysis to eliminate conflicts
# 
# STRATEGY:
# ‚úÖ Keep ONLY dependencies we actually USE for our specific integration
# ‚ùå Eliminate ALL dependencies from unused components
# üéØ Use compatible middle-ground versions where possible
#
# ELIMINATED MAJOR CONFLICTS:
# ‚ùå mmpose, mmcv, mmdet     - Only used for dwpose (pose detection) - WE SKIP THIS
# ‚ùå tensorflow, tensorboard - Only used for training - WE ONLY DO INFERENCE  
# ‚ùå insightface             - LatentSync face detection - WE USE MUSETALK'S INSTEAD
# ‚ùå mediapipe              - LatentSync preprocessing - WE USE MUSETALK'S PIPELINE
# ‚ùå onnxruntime-gpu        - Used by insightface - NOT NEEDED
# ‚ùå face-alignment         - Redundant with MuseTalk's S3FD detection
# ‚ùå scenedetect, lpips, kornia - Preprocessing/training only
# ‚ùå DeepCache              - Optional optimization - NOT CRITICAL
#
# DEPENDENCY REDUCTION: ~70% (12+ eliminated vs 8 core required)

# =============================================================================
# CORE PYTORCH STACK - Compatible middle ground
# =============================================================================
# STRATEGY: Use PyTorch 2.2.0 - newer than MuseTalk (2.0.1), older than LatentSync (2.5.1)
# This avoids the catastrophic PyTorch 2.0.1 vs 2.5.1 conflict
torch==2.2.0
torchvision==0.17.0
torchaudio==2.2.0
--extra-index-url https://download.pytorch.org/whl/cu118

# =============================================================================
# ML LIBRARIES - Updated for LatentSync UNet3D compatibility
# =============================================================================
# STRATEGY: Use LatentSync versions (newer) - more likely to be backwards compatible
diffusers==0.32.2          # LatentSync requirement (vs MuseTalk 0.30.2) - NEEDED for UNet3D
transformers==4.48.0       # LatentSync requirement (vs MuseTalk 4.39.2) - NEEDED for Whisper
numpy==1.26.4              # LatentSync requirement (vs MuseTalk 1.23.5) - Major version jump but manageable
accelerate==0.28.0         # MuseTalk has newer version - SAFER to keep

# =============================================================================
# AUDIO PROCESSING - MuseTalk pipeline (KEEP)
# =============================================================================
librosa==0.11.0            # MuseTalk has newer version - SAFER to keep  
soundfile==0.12.1          # MuseTalk specific - REQUIRED for audio I/O

# =============================================================================
# COMPUTER VISION - Both systems need this
# =============================================================================
opencv-python==4.9.0.80    # Same version in both - NO CONFLICT
einops==0.8.1              # MuseTalk has newer version - SAFER to keep

# =============================================================================
# UI AND WEB INTERFACE
# =============================================================================
gradio==5.24.0             # Same version in both - NO CONFLICT
huggingface_hub==0.30.2    # Same version in both - NO CONFLICT

# =============================================================================
# CONFIGURATION AND UTILITIES
# =============================================================================
omegaconf==2.3.0           # LatentSync version (MuseTalk was unversioned)
ffmpeg-python==0.2.0       # LatentSync version (MuseTalk was unversioned)
imageio==2.31.1            # LatentSync version

# =============================================================================
# BASIC UTILITIES - No version conflicts
# =============================================================================
gdown                      # MuseTalk utility - no version specified
requests                   # MuseTalk utility - no version specified
imageio[ffmpeg]           # MuseTalk utility - with ffmpeg support

# =============================================================================
# SURGICAL NOTES - What we're SKIPPING and WHY
# =============================================================================
#
# FROM MUSETALK (SKIPPED):
# ‚ùå tensorflow==2.12.0     # ONLY used in train.py and training_utils.py - WE SKIP TRAINING  
# ‚ùå tensorboard==2.12.0    # ONLY used for training monitoring - WE SKIP TRAINING
# ‚ùå moviepy                # Media utility - we use ffmpeg-python instead
#
# FROM LATENTSYNC (SKIPPED):  
# ‚ùå insightface==0.7.3     # Face detection - WE USE MUSETALK'S S3FD INSTEAD
# ‚ùå mediapipe==0.10.11     # Used in preprocessing - WE USE MUSETALK'S PIPELINE
# ‚ùå onnxruntime-gpu==1.21.0 # Used by insightface - NOT NEEDED
# ‚ùå face-alignment==1.4.1  # Redundant with MuseTalk's detection
# ‚ùå scenedetect==0.6.1     # Video scene detection - NOT NEEDED for our use case
# ‚ùå lpips==0.1.4           # Perceptual loss - ONLY used in training/evaluation
# ‚ùå kornia==0.8.0          # Image transforms - ONLY used in preprocessing  
# ‚ùå python_speech_features==0.6 # Audio features - redundant with librosa
# ‚ùå decord==0.6.0          # Video decoding - we use opencv instead
# ‚ùå DeepCache==0.1.1       # Inference optimization - NICE TO HAVE, not critical
#
# MMLAP ECOSYSTEM (COMPLETELY ELIMINATED):
# ‚ùå openmim                # ONLY needed for mmpose installation
# ‚ùå mmengine               # ONLY needed for mmpose
# ‚ùå mmcv==2.0.1            # ONLY needed for mmpose - MAJOR CONFLICT ELIMINATED
# ‚ùå mmdet==3.1.0           # ONLY needed for mmpose - MAJOR CONFLICT ELIMINATED  
# ‚ùå mmpose==1.1.0          # ONLY used for dwpose (pose detection) - WE SKIP THIS
#
# =============================================================================
# INTEGRATION STRATEGY NOTES
# =============================================================================
#
# 1. FACE DETECTION: Use MuseTalk's S3FD (musetalk/utils/face_detection/)
#    - Skip dwpose completely (eliminates mmpose ecosystem)
#    - Skip LatentSync's insightface (eliminates insightface, onnxruntime-gpu)
#
# 2. PREPROCESSING: Use MuseTalk's enhanced pipeline  
#    - Skip LatentSync preprocessing (eliminates mediapipe, scenedetect, kornia)
#    - Use our existing get_landmark_and_bbox_enhanced()
#
# 3. INFERENCE: Surgical UNet replacement
#    - Keep MuseTalk's VAE, audio processing, frame handling
#    - Replace ONLY the UNet inference step with LatentSync's UNet3D
#    - Skip LatentSync's full pipeline
#
# 4. POST-PROCESSING: Use MuseTalk's blending and output
#    - Keep our working passthrough logic
#    - Keep our frame blending with get_image()
#
# EXPECTED RESULT:
# ‚úÖ ~70% dependency reduction
# ‚úÖ Eliminates all major version conflicts (PyTorch, MMLab ecosystem)
# ‚úÖ Maintains reliability of working MuseTalk pipeline
# ‚úÖ Adds LatentSync quality only where beneficial